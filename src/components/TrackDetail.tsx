import { Show } from "solid-js";
import { Track } from "../routes/music/index";
import { apiroot } from "~/app";
import AudioPlayer from "./AudioPlayer";
import { A } from "@solidjs/router";

export default function TrackDetail(
  props: { track: Track; displayMode: "list" | "widget" },
) {
  const track = () => props.track;

  const isMediaAvailable = (mediaType: keyof Track) => !!track()[mediaType];

  return (
    <>
      <div class="flex-col p-4 bg-gray-800 text-white transition hover:bg-gray-700 border border-gray-600 shadow-md transform">
        <Show when={props.displayMode === "widget"}>
          <div class="flex flex-wrap overflow-hidden">
          <div class="w-1/4">
            <img
              src={isMediaAvailable("image")
                ? `${apiroot}/music/${props.track.id}/preview`
                : "/musicplc.png"}
              alt={track().title}
              class="w-full h-auto rounded"
              elementtiming={""}
              fetchpriority={"high"}
            />
          </div>
          <div class="w-3/4 pl-4">
            <div class="flex flex-col justify-between h-full">
              <A href={`/music/${props.track.id}`}>
                <h2 class="text-xl font-semibold mb-2">{track().title}</h2>
                <p class="text-gray-300 mb-1">{track().album}</p>
                <p class="text-gray-300 mb-1">Year: {track().year}</p>
                <p class="text-gray-300">Genre: {track().genre}</p>
                <Show when={track().opusNumber}>
                  <p class="text-gray-300">Opus Number: {track().opusNumber}</p>
                </Show>
              </A>
              <div>
                <p class="text-gray-400 mt-4">{track().description}</p>
              </div>
              <div class="flex flex-wrap overflow-hidden mt-4">
                <Show when={isMediaAvailable("audio")}>
                  <a
                    href={`${apiroot}/music/${props.track.id}/audio`}
                    class="mr-2"
                  >
                    <button class="flex items-center px-4 py-2 border rounded bg-gray-700 text-white">
                      <svg
                        fill="#ffffff"
                        class="h-4 w-4 mr-2"
                        viewBox="0 0 588.6 588.6"
                        stroke="#ffffff"
                      >
                        <g id="SVGRepo_iconCarrier">
                          <g>
                            <path d="M359.036,537.775c0.771,0.053,1.551,0.116,2.342,0.116h178.2c20.84,0,37.8-16.96,37.8-37.801V86.994 c0-20.838-16.96-37.8-37.8-37.8h-178.2c-0.786,0-1.571,0.071-2.342,0.119V0L11.222,46.417v494.564L359.036,588.6V537.775z M359.036,71.036c0.771-0.113,1.54-0.237,2.342-0.237h178.2c8.933,0,16.199,7.27,16.199,16.2v413.103 c0,8.928-7.267,16.2-16.199,16.2h-178.2c-0.797,0-1.571-0.121-2.342-0.242V71.036z M81.466,339.388 c-26.401-0.718-41.515-22.612-41.515-49.961c0-28.769,16.675-50.709,42.979-51.405c28.171-0.751,43.896,21.945,43.896,49.663 C126.826,320.63,108.21,340.105,81.466,339.388z M224.521,336.651c-7.246,2.315-20.817,5.385-34.225,5.025 c-18.225-0.475-31.216-5.511-40.165-14.771c-8.873-8.886-13.7-22.144-13.577-36.964c0.158-33.565,23.53-53.352,56.133-54.195 c13.133-0.34,23.361,2.038,28.437,4.406l-4.925,19.145c-5.664-2.415-12.656-4.316-23.812-4.126 c-18.857,0.298-32.877,11.443-32.877,33.57c0,21.062,12.701,33.708,31.229,34.014c5.255,0.101,9.471-0.442,11.285-1.339v-21.832 l-15.623-0.096v-18.277l38.119-0.127V336.651z M335.77,339.266c-8.047,2.442-23.129,5.664-38.011,5.258 c-20.208-0.521-34.604-5.848-44.508-15.614c-9.819-9.355-15.158-23.298-15.008-38.892c0.158-35.295,26.029-56.139,62.185-57.074 c14.555-0.377,25.924,2.117,31.562,4.619l-5.469,20.163c-6.286-2.539-14.06-4.532-26.431-4.337 c-20.915,0.345-36.46,12.076-36.46,35.377c0,22.162,14.078,35.482,34.636,35.835c5.821,0.101,10.504-0.475,12.519-1.424v-23.003 l-17.342-0.095v-19.237l42.327-0.155V339.266z" />
                            <path d="M82.399,255.656c-13.7,0.237-21.6,14.494-21.6,33.352c0,19.014,8.166,32.545,21.734,32.782 c13.901,0.248,21.956-14.054,21.956-33.36C104.495,270.609,96.575,255.414,82.399,255.656z" />
                            <path d="M395.359,379.466c12.683-3.144,21.506-12.741,21.568-22.528h0.021l0.343-103.291l74.503-13.618v83.038 c-5.416-1.92-11.902-2.247-18.483-0.623c-14.575,3.649-24.11,15.637-21.315,26.837c2.795,11.169,16.854,17.271,31.43,13.658 c13.279-3.354,21.779-12.466,21.779-23.867V201.248l-101.682,16.49V340.01c-5.326-1.867-11.676-2.193-18.162-0.569 c-14.428,3.606-23.867,15.482-21.104,26.546C365.871,376.228,380.963,383.083,395.359,379.466z" />
                          </g>
                        </g>
                      </svg>
                      Download Audio
                    </button>
                  </a>
                </Show>
                <Show when={isMediaAvailable("score")}>
                  <a
                    href={`${apiroot}/music/${props.track.id}/score`}
                    class="mr-2"
                  >
                    <button class="flex items-center px-4 py-2 border rounded bg-gray-700 text-white">
                      <svg
                        class="w-4 h-4 mr-2"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 512 512"
                      >
                        <g id="SVGRepo_iconCarrier">
                          <style type="text/css">{`.st0{fill:#ffffff;}`}</style>
                          <g>
                            <path
                              class="st0"
                              d="M378.413,0H208.297h-13.182L185.8,9.314L57.02,138.102l-9.314,9.314v13.176v265.514 c0,47.36,38.528,85.895,85.896,85.895h244.811c47.353,0,85.881-38.535,85.881-85.895V85.896C464.294,38.528,425.766,0,378.413,0z M432.497,426.105c0,29.877-24.214,54.091-54.084,54.091H133.602c-29.884,0-54.098-24.214-54.098-54.091V160.591h83.716 c24.885,0,45.077-20.178,45.077-45.07V31.804h170.116c29.87,0,54.084,24.214,54.084,54.092V426.105z"
                            />
                            <path
                              class="st0"
                              d="M171.947,252.785h-28.529c-5.432,0-8.686,3.533-8.686,8.825v73.754c0,6.388,4.204,10.599,10.041,10.599 c5.711,0,9.914-4.21,9.914-10.599v-22.406c0-0.545,0.279-0.817,0.824-0.817h16.436c20.095,0,32.188-12.226,32.188-29.612 C204.136,264.871,192.182,252.785,171.947,252.785z M170.719,294.888h-15.208c-0.545,0-0.824-0.272-0.824-0.81v-23.23 c0-0.545,0.279-0.816,0.824-0.816h15.208c8.42,0,13.447,5.027,13.447,12.498C184.167,290,179.139,294.888,170.719,294.888z"
                            />
                            <path
                              class="st0"
                              d="M250.191,252.785h-21.868c-5.432,0-8.686,3.533-8.686,8.825v74.843c0,5.3,3.253,8.693,8.686,8.693h21.868 c19.69,0,31.923-6.249,36.81-21.324c1.76-5.3,2.723-11.681,2.723-24.857c0-13.175-0.964-19.557-2.723-24.856 C282.113,259.034,269.881,252.785,250.191,252.785z M267.856,316.896c-2.318,7.331-8.965,10.459-18.21,10.459h-9.23 c-0.545,0-0.824-0.272-0.824-0.816v-55.146c0-0.545,0.279-0.817,0.824-0.817h9.23c9.245,0,15.892,3.128,18.21,10.46 c0.95,3.128,1.62,8.56,1.62,17.93C269.476,308.336,268.805,313.768,267.856,316.896z"
                            />
                            <path
                              class="st0"
                              d="M361.167,252.785h-44.812c-5.432,0-8.7,3.533-8.7,8.825v73.754c0,6.388,4.218,10.599,10.055,10.599 c5.697,0,9.914-4.21,9.914-10.599v-26.351c0-0.538,0.265-0.81,0.81-0.81h26.086c5.837,0,9.23-3.532,9.23-8.56 c0-5.028-3.393-8.553-9.23-8.553h-26.086c-0.545,0-0.81-0.272-0.81-0.817v-19.425c0-0.545,0.265-0.816,0.81-0.816h32.733 c5.572,0,9.245-3.666,9.245-8.553C370.411,256.45,366.738,252.785,361.167,252.785z"
                            />
                          </g>
                        </g>
                      </svg>
                      Download Score
                    </button>
                  </a>
                </Show>
                <Show when={isMediaAvailable("midi")}>
                  <a
                    href={`${apiroot}/music/${props.track.id}/midi`}
                    class="mr-2"
                  >
                    <button class="flex items-center px-4 py-2 border rounded bg-gray-700 text-white">
                      <svg
                        class="w-4 h-4 mr-2"
                        xmlns="http://www.w3.org/2000/svg"
                        viewBox="0 0 192 192"
                      >
                        <g id="SVGRepo_iconCarrier">
                          <g fill="none" stroke="#ffffff" stroke-width="12">
                            <path d="M78 153a24 17 0 0 1-24 17 24 17 0 0 1-24-17 24 17 0 0 1 24-17 24 17 0 0 1 24 17zm80-27a24 17 0 0 1-24 17 24 17 0 0 1-24-17 24 17 0 0 1 24-17 24 17 0 0 1 24 17z" />
                            <path
                              stroke-linejoin="round"
                              d="M78 153V45l80-20v101"
                            />
                            <path d="m78 69 80-20" />
                          </g>
                        </g>
                      </svg>
                      Download MIDI
                    </button>
                  </a>
                </Show>
                <Show when={isMediaAvailable("mscz")}>
                  <a href={`${apiroot}/music/${props.track.id}/mscz`}>
                    <button class="flex items-center px-4 py-2 border rounded bg-gray-700 text-white">
                      <svg
                        fill="#ffffff"
                        class="w-4 h-4 mr-2"
                        viewBox="0 0 24 24"
                        stroke="#ffffff"
                      >
                        <g id="SVGRepo_iconCarrier">
                          <title>MuseScore icon</title>
                          <path d="M11.777 23.997a11.989 11.989 0 0 1-8.98-4.296 12.013 12.013 0 0 1-2.406-4.655A12.1 12.1 0 0 1 .273 9.44a11.926 11.926 0 0 1 1.72-4.064 12.056 12.056 0 0 1 4.056-3.799 11.94 11.94 0 0 1 4.13-1.44 12.211 12.211 0 0 1 3.693.007c1.708.27 3.302.89 4.751 1.848.873.577 1.692 1.29 2.385 2.08a11.966 11.966 0 0 1 2.68 5.196c.402 1.718.416 3.556.039 5.291a12.004 12.004 0 0 1-4.024 6.643 12.013 12.013 0 0 1-4.655 2.407c-.743.195-1.499.316-2.29.367a17.83 17.83 0 0 1-.809.026l-.172-.003zm-6.924-6.684a.488.488 0 0 0 .23-.133.548.548 0 0 0 .139-.232c.013-.043.014-.178.018-2.363.004-2.12.005-2.327.018-2.438.033-.298.076-.51.146-.72.101-.303.224-.516.406-.705.14-.144.26-.232.434-.315a1.76 1.76 0 0 1 .504-.148c.114-.017.382-.024.493-.012a1.803 1.803 0 0 1 1.308.807c.166.25.271.528.327.866l.017.106.004 2.438c.004 2.324.005 2.44.019 2.485a.555.555 0 0 0 .133.226.5.5 0 0 0 .201.128c.052.019.068.021.167.021a.462.462 0 0 0 .37-.145.507.507 0 0 0 .149-.3c.006-.042.008-.774.008-2.407 0-1.542.003-2.375.008-2.428.047-.48.222-.889.523-1.225.183-.204.464-.39.73-.482.21-.074.394-.101.626-.095.304.01.55.066.8.186.284.136.514.341.668.597.178.294.28.662.299 1.083.002.053.013.491.023.973.022 1.002.024 1.063.04 1.238.072.787.307 1.426.711 1.935.087.11.311.333.417.417.435.344.944.555 1.532.634.177.024.507.03.68.012.797-.082 1.53-.463 2.015-1.046.373-.45.606-.99.704-1.64.046-.302.043-.143.046-2.506.003-2.417.007-2.223-.054-2.346a.484.484 0 0 0-.332-.251.584.584 0 0 0-.416.06c-.1.06-.19.183-.22.304-.009.031-.012.478-.016 2.22-.005 2.415 0 2.23-.055 2.51-.18.917-.81 1.522-1.73 1.66a2.358 2.358 0 0 1-.512-.008c-.464-.07-.84-.256-1.13-.557-.332-.345-.53-.816-.601-1.432-.018-.151-.026-.387-.043-1.212-.018-.853-.026-1.05-.047-1.24-.129-1.123-.68-1.983-1.548-2.417a2.773 2.773 0 0 0-1.121-.294c-.55-.035-1.136.12-1.671.441a2.949 2.949 0 0 0-.813.707l-.038.049-.028-.038a2.542 2.542 0 0 0-.235-.261c-.457-.433-1.1-.722-1.78-.8a3.877 3.877 0 0 0-.65-.001c-.635.07-1.141.286-1.559.666-.48.437-.795 1.103-.912 1.926-.056.393-.057.436-.054 2.915l.002 2.184.022.064a.525.525 0 0 0 .359.339c.078.02.188.02.267 0zm11.99-8.863a.687.687 0 0 0 .546-.505.849.849 0 0 0 .008-.3.685.685 0 0 0-.455-.516.678.678 0 0 0-.895.649c0 .055.005.11.012.142a.684.684 0 0 0 .783.53zm-2.667-.138a.495.495 0 0 0 .32-.265c.046-.092.06-.158.067-.343a2.224 2.224 0 0 1 .617-1.49 1.934 1.934 0 0 1 1.146-.587c.145-.022.434-.024.581-.004.307.043.58.143.822.3.244.16.474.4.634.663.202.333.326.763.327 1.127 0 .1.012.184.036.26a.507.507 0 0 0 .94.068c.053-.111.06-.15.059-.35 0-.198-.01-.318-.043-.514-.217-1.298-1.165-2.294-2.426-2.545a2.47 2.47 0 0 0-.625-.055 3.031 3.031 0 0 0-2.738 1.638 3.3 3.3 0 0 0-.366 1.43c-.01.265.037.418.167.544a.509.509 0 0 0 .482.123z" />
                        </g>
                      </svg>
                      Download MSCZ
                    </button>
                  </a>
                </Show>
              </div>
            </div>
          </div>
          </div>
        </Show>
        <Show when={props.displayMode === "list"}>
          <A href={`/music/${props.track.id}`}>
            <h2 class="text-xl font-semibold mb-2">{track().title}</h2>
            <p class="text-gray-400 mb-1">Year: {track().year}</p>
            <p class="text-gray-400">Genre: {track().genre}</p>
          </A>
        </Show>
      <Show when={isMediaAvailable("audio")}>
          <AudioPlayer
            src={`${apiroot}/music/${props.track.id}/audio`}
            class="mt-4"
          />
        </Show>
      </div>
    </>
  );
}
